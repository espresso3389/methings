androidDevice:
  get:
    operationId: getAndroidDevice
    summary: Get Android device information
    tags: [Android]
    description: >
      Returns hardware and software details about the Android device:
      manufacturer, model, OS version, screen metrics, locale, etc.
      No permission check required.
    responses:
      '200':
        description: Device information.
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  const: ok
                manufacturer:
                  type: string
                  description: Device manufacturer (e.g. "Google").
                model:
                  type: string
                  description: Device model name (e.g. "Pixel 7").
                brand:
                  type: string
                  description: Consumer-visible brand (e.g. "google").
                device:
                  type: string
                  description: Industrial design name (e.g. "panther").
                product:
                  type: string
                  description: Product name (e.g. "panther").
                board:
                  type: string
                  description: Board name (e.g. "pantah").
                hardware:
                  type: string
                  description: Hardware name (e.g. "tensor").
                display:
                  type: string
                  description: Build display ID.
                android_version:
                  type: string
                  description: Android version string (e.g. "13").
                sdk_int:
                  type: integer
                  description: Android SDK integer (e.g. 33).
                security_patch:
                  type: string
                  description: Security patch date (e.g. "2023-01-05").
                build_id:
                  type: string
                  description: Build ID (e.g. "TP1A.221005.002").
                fingerprint:
                  type: string
                  description: Full build fingerprint.
                supported_abis:
                  type: array
                  items:
                    type: string
                  description: Supported CPU ABIs (e.g. ["arm64-v8a", "armeabi-v7a"]).
                screen_density_dpi:
                  type: integer
                  description: Screen density in DPI (e.g. 420).
                screen_width_px:
                  type: integer
                  description: Screen width in pixels.
                screen_height_px:
                  type: integer
                  description: Screen height in pixels.
                locale:
                  type: string
                  description: Device locale as BCP-47 tag (e.g. "en-US").
            example:
              status: ok
              manufacturer: Google
              model: Pixel 7
              brand: google
              device: panther
              product: panther
              board: pantah
              hardware: tensor
              display: TP1A.221005.002
              android_version: "13"
              sdk_int: 33
              security_patch: "2023-01-05"
              build_id: TP1A.221005.002
              fingerprint: "google/panther/panther:13/..."
              supported_abis: ["arm64-v8a", "armeabi-v7a"]
              screen_density_dpi: 420
              screen_width_px: 1080
              screen_height_px: 2400
              locale: en-US

androidPermissions:
  get:
    operationId: getAndroidPermissions
    summary: List Android manifest permissions with grant status
    tags: [Android]
    description: >
      Returns every permission declared in the app manifest together with
      whether it is currently granted by the Android runtime.
      No permission check required.
    responses:
      '200':
        description: Permission list.
        content:
          application/json:
            schema:
              type: object
              required: [status, permissions]
              properties:
                status:
                  type: string
                  const: ok
                permissions:
                  type: array
                  items:
                    type: object
                    required: [name, granted]
                    properties:
                      name:
                        type: string
                        description: Fully-qualified Android permission name.
                      granted:
                        type: boolean
                        description: Whether the permission is currently granted.
            example:
              status: ok
              permissions:
                - name: android.permission.BLUETOOTH_SCAN
                  granted: true
                - name: android.permission.CAMERA
                  granted: false

androidPermissionsStatus:
  get:
    operationId: getAndroidPermissionsStatus
    summary: Get Android permission dialog timing status
    tags: [Android]
    description: >
      Returns timing snapshots for in-flight and recent Android system permission
      dialogs, including runtime permission requests and USB OS permission prompts.
      Use this to display request-to-response timing in UI.
    responses:
      '200':
        description: Permission timing status.
        content:
          application/json:
            schema:
              type: object
              required:
                - status
                - now_ms
                - pending_permission_requests
                - recent_permission_requests
                - usb_pending_permission_requests
                - usb_recent_permission_requests
              properties:
                status:
                  type: string
                  const: ok
                now_ms:
                  type: integer
                  format: int64
                pending_permission_requests:
                  type: array
                  items:
                    type: object
                    required: [request_id, permissions, requested_at_ms, age_ms, timed_out]
                    properties:
                      request_id:
                        type: string
                      permissions:
                        type: array
                        items: { type: string }
                      requested_at_ms:
                        type: integer
                        format: int64
                      age_ms:
                        type: integer
                        format: int64
                      timed_out:
                        type: boolean
                recent_permission_requests:
                  type: array
                  items:
                    type: object
                    required: [request_id, permissions, requested_at_ms, responded, timed_out]
                    properties:
                      request_id:
                        type: string
                      permissions:
                        type: array
                        items: { type: string }
                      requested_at_ms:
                        type: integer
                        format: int64
                      responded:
                        type: boolean
                      results:
                        nullable: true
                        type: object
                        additionalProperties: { type: boolean }
                      completed_at_ms:
                        nullable: true
                        type: integer
                        format: int64
                      timed_out:
                        type: boolean
                usb_pending_permission_requests:
                  type: array
                  items:
                    type: object
                    required: [device_name, requested_at_ms, age_ms, timed_out]
                    properties:
                      device_name:
                        type: string
                      requested_at_ms:
                        type: integer
                        format: int64
                      age_ms:
                        type: integer
                        format: int64
                      timed_out:
                        type: boolean
                usb_recent_permission_requests:
                  type: array
                  items:
                    type: object
                    required: [device_name, requested_at_ms, responded, timed_out]
                    properties:
                      device_name:
                        type: string
                      requested_at_ms:
                        type: integer
                        format: int64
                      responded:
                        type: boolean
                      granted:
                        nullable: true
                        type: boolean
                      completed_at_ms:
                        nullable: true
                        type: integer
                        format: int64
                      timed_out:
                        type: boolean
            example:
              status: ok
              now_ms: 1767609200000
              pending_permission_requests:
                - request_id: req_123
                  permissions: [android.permission.CAMERA]
                  requested_at_ms: 1767609197000
                  age_ms: 3000
                  timed_out: false
              recent_permission_requests:
                - request_id: req_122
                  permissions: [android.permission.RECORD_AUDIO]
                  requested_at_ms: 1767609185000
                  responded: true
                  results:
                    android.permission.RECORD_AUDIO: true
                  completed_at_ms: 1767609187900
                  timed_out: false
              usb_pending_permission_requests: []
              usb_recent_permission_requests:
                - device_name: /dev/bus/usb/001/003
                  requested_at_ms: 1767609173000
                  responded: true
                  granted: false
                  completed_at_ms: 1767609176800
                  timed_out: false

androidPermissionsRequest:
  post:
    operationId: postAndroidPermissionsRequest
    summary: Request Android runtime permissions
    tags: [Android]
    description: >
      Triggers the Android system permission dialog for the specified
      permissions. Only permissions declared in the app manifest are
      accepted. Already-granted permissions are skipped (no dialog shown).
      The call blocks until the user responds or 60 seconds elapse.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [permissions]
            properties:
              permissions:
                type: array
                items:
                  type: string
                description: >
                  Fully-qualified Android permission names to request
                  (e.g. ["android.permission.BLUETOOTH_SCAN"]).
          example:
            permissions:
              - android.permission.BLUETOOTH_SCAN
              - android.permission.BLUETOOTH_CONNECT
    responses:
      '200':
        description: Per-permission grant results.
        content:
          application/json:
            schema:
              type: object
              required: [status, results, all_granted]
              properties:
                status:
                  type: string
                  const: ok
                results:
                  type: object
                  additionalProperties:
                    type: boolean
                  description: >
                    Map of permission name to granted boolean.
                all_granted:
                  type: boolean
                  description: True if every requested permission is now granted.
            example:
              status: ok
              results:
                android.permission.BLUETOOTH_SCAN: true
                android.permission.BLUETOOTH_CONNECT: true
              all_granted: true
      '400':
        description: Invalid request (missing/empty permissions array, or unknown permissions).
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/ErrorResponse'
