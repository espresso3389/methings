workerStatus:
  get:
    operationId: getWorkerStatus
    summary: Get embedded worker status
    tags: [Worker]
    responses:
      '200':
        description: Current embedded worker status.
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [ok, offline, starting, stopping]
                  description: Status of the embedded Python worker.
            example:
              status: ok

workerRestart:
  post:
    operationId: postWorkerRestart
    summary: Restart the embedded worker
    tags: [Worker]
    requestBody:
      required: false
      content:
        application/json:
          schema:
            type: object
    responses:
      '200':
        description: Restart initiated.
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  const: ok
            example:
              status: ok

workerArduinoProxyStatus:
  get:
    operationId: getWorkerArduinoProxyStatus
    summary: Get Arduino CLI DNS-bypass proxy status
    description: >
      Returns status of the worker-side Arduino proxy module.
      The proxy runs locally and maps `downloads.arduino.cc` to a fixed IPv4
      to bypass Android DNS issues.
    tags: [Worker]
    responses:
      '200':
        description: Arduino proxy status.
        content:
          application/json:
            schema:
              type: object
              required: [module, running, proxy_url]
              properties:
                module:
                  type: string
                  const: arduino_proxy
                running:
                  type: boolean
                listen_host:
                  type: string
                listen_port:
                  type: integer
                proxy_url:
                  type: string
                host_map:
                  type: object
                  additionalProperties:
                    type: string

workerArduinoProxyEnable:
  post:
    operationId: postWorkerArduinoProxyEnable
    summary: Enable Arduino CLI DNS-bypass proxy module
    description: >
      Ensures the embedded worker's Arduino proxy is running and applies
      `arduino-cli config set network.proxy http://127.0.0.1:38888`.
      Safe to call repeatedly.
    tags: [Worker]
    requestBody:
      required: false
      content:
        application/json:
          schema:
            type: object
            properties:
              listen_port:
                type: integer
                minimum: 1024
                maximum: 65535
                description: Optional proxy listen port. Default is 38888.
              downloads_ipv4:
                type: string
                description: Optional IPv4 override for `downloads.arduino.cc`. Default is 104.18.11.21.
    responses:
      '200':
        description: Arduino proxy enabled/configured.
        content:
          application/json:
            schema:
              type: object
              required: [status, module, proxy, arduino_cli]
              properties:
                status:
                  type: string
                  const: ok
                module:
                  type: string
                  const: arduino_proxy
                proxy:
                  type: object
                arduino_cli:
                  type: object
