ErrorResponse:
  type: object
  required: [status, error]
  properties:
    status:
      type: string
      const: error
    error:
      type: string
      description: Machine-readable error code.
    detail:
      description: Additional context; type varies by endpoint.
  example:
    status: error
    error: location_manager_unavailable

PermissionRequest:
  type: object
  required: [id, status, tool, detail, scope, created_at, identity, capability]
  properties:
    id:
      type: string
      description: Unique permission request ID.
    status:
      type: string
      description: Current status of the request (e.g. "pending").
    tool:
      type: string
      description: Tool category that triggered the request.
      examples: [device.screen, device.gps]
    detail:
      type: string
      description: Human-readable description shown in the approval prompt.
    scope:
      type: string
      enum: [once, program, session, persistent]
      description: How long the grant remains valid.
    created_at:
      type: integer
      format: int64
      description: Unix epoch millis when the request was created.
    identity:
      type: string
      description: Caller identity (typically session ID).
    capability:
      type: string
      description: Capability tag for the grant.
      examples: [screen, location]

PermissionRequiredResponse:
  type: object
  required: [status, request]
  properties:
    status:
      type: string
      const: permission_required
    request:
      $ref: '#/PermissionRequest'
  example:
    status: permission_required
    request:
      id: perm_abc123
      status: pending
      tool: device.screen
      detail: Keep screen on
      scope: session
      created_at: 1700000000000
      identity: sess_xyz
      capability: screen

ScreenStatusResponse:
  type: object
  required: [status, keep_screen_on, expires_at]
  properties:
    status:
      type: string
      const: ok
    keep_screen_on:
      type: boolean
      description: Whether the screen is currently being kept on.
    expires_at:
      type: integer
      format: int64
      description: >
        Unix epoch millis when keep-screen-on will expire.
        0 if no timeout is set or screen-on is disabled.
  example:
    status: ok
    keep_screen_on: true
    expires_at: 1700000300000

PermissionFields:
  type: object
  description: >
    Optional fields for authenticated / pre-approved requests.
    Include these in the request body (POST) or query string (GET)
    to skip or expedite the permission prompt.
  properties:
    identity:
      type: string
      description: Caller identity (e.g. chat session ID).
    permission_id:
      type: string
      description: Previously approved permission request ID.

SshTargetFields:
  type: object
  description: Common SSH target connection fields.
  required: [host]
  properties:
    host:
      type: string
      description: Remote hostname or IP address.
    user:
      type: string
      description: Remote username. Defaults to device SSH identity user.
    port:
      type: integer
      default: 22
      description: Remote SSH port.

Schedule:
  type: object
  required: [id, name, launch_type, schedule_pattern, runtime, code, enabled, created_at, updated_at]
  properties:
    id:
      type: string
      description: Schedule UUID.
    name:
      type: string
      description: Human-readable label.
    launch_type:
      type: string
      enum: [daemon, periodic, one_time]
    schedule_pattern:
      type: string
      description: >
        Firing pattern. `minutely`, `hourly`, `daily`, `weekly:Mon`..`weekly:Sun`,
        `monthly:1`..`monthly:28`, or empty string for daemon/one_time.
    runtime:
      type: string
      enum: [run_js, run_python]
    code:
      type: string
      description: Source code to execute.
    args:
      type: string
      description: Extra CLI args (run_python only).
    cwd:
      type: string
      description: Working directory (run_python only).
    timeout_ms:
      type: integer
      description: Execution timeout in milliseconds.
    enabled:
      type: boolean
    created_at:
      type: integer
      format: int64
      description: Unix epoch millis.
    updated_at:
      type: integer
      format: int64
    last_run_at:
      type: integer
      format: int64
      description: Epoch ms of last execution start (0 if never run).
    next_run_at:
      type: integer
      format: int64
      nullable: true
      description: Epoch ms of next planned run (null for daemons).
    run_count:
      type: integer
    error_count:
      type: integer
    meta:
      type: string
      description: JSON blob for extensibility.
  example:
    id: "a1b2c3d4-5678-90ab-cdef-1234567890ab"
    name: "heartbeat"
    launch_type: "periodic"
    schedule_pattern: "minutely"
    runtime: "run_js"
    code: "Date.now()"
    args: ""
    cwd: ""
    timeout_ms: 60000
    enabled: true
    created_at: 1700000000000
    updated_at: 1700000000000
    last_run_at: 1700000060000
    next_run_at: 1700000120000
    run_count: 5
    error_count: 0
    meta: "{}"

ExecutionLogEntry:
  type: object
  required: [id, schedule_id, started_at, finished_at, status]
  properties:
    id:
      type: integer
      description: Log row ID.
    schedule_id:
      type: string
    started_at:
      type: integer
      format: int64
    finished_at:
      type: integer
      format: int64
    status:
      type: string
      enum: [running, ok, error, timeout, interrupted]
    result:
      type: string
      nullable: true
      description: Return value / stdout (truncated to 8 KB).
    console_output:
      type: string
      nullable: true
      description: console.log output (JS) or stderr (Python).
    error:
      type: string
      nullable: true
      description: Error message if failed.
  example:
    id: 42
    schedule_id: "a1b2c3d4-..."
    started_at: 1700000060000
    finished_at: 1700000060050
    status: "ok"
    result: "1700000060025"
    console_output: ""
    error: null

SshOutputFields:
  type: object
  description: Common SSH command output fields.
  properties:
    stdout:
      type: string
      description: Standard output (may be truncated).
    stderr:
      type: string
      description: Standard error (may be truncated).
    exit_code:
      type: integer
      description: Process exit code.
    truncated:
      type: boolean
      description: Whether output was truncated due to size limits.
    timed_out:
      type: boolean
      description: Whether the command timed out.
