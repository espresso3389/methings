<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Licenses - me.things</title>
    <style>
      body {
        margin: 0;
        font: 14px/1.5 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        color: #e9edf2;
        background: #0b1020;
      }
      .wrap {
        max-width: 920px;
        margin: 0 auto;
        padding: 18px 14px 40px;
      }
      h1 {
        margin: 0 0 6px;
        font-size: 24px;
      }
      h2 {
        margin: 20px 0 8px;
        font-size: 18px;
      }
      .muted {
        color: #9aa7bb;
      }
      .card {
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 10px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.03);
        margin-top: 12px;
      }
      .section {
        margin-top: 14px;
      }
      .section h3 {
        margin: 0 0 8px;
        font-size: 15px;
      }
      .dep {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 13px;
        line-height: 1.45;
        margin: 2px 0;
      }
      pre {
        white-space: pre-wrap;
        margin: 0;
        color: #d8e0ec;
      }
      a {
        color: #77c4ff;
      }
      .top {
        margin-top: 8px;
      }
      button {
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        padding: 8px 12px;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Licenses</h1>
      <div class="muted">App license and third-party open source notices.</div>
      <div class="top">
        <button onclick="history.back()">Back</button>
      </div>

      <h2>me.things</h2>
      <div class="card">
        <div class="muted">MIT License</div>
        <pre>Copyright (c) 2026 Takashi Kawasaki (@espresso3389)</pre>
      </div>

      <h2>Third-Party OSS</h2>
      <div class="card">
        <div id="depSummary" class="muted">Loading dependency inventory...</div>
        <div id="depSections"></div>
        <div class="muted">
          Source repository:
          <a href="https://github.com/espresso3389/methings" target="_blank" rel="noopener">https://github.com/espresso3389/methings</a>
        </div>
      </div>
    </div>
    <script>
      (async function() {
        const summary = document.getElementById("depSummary");
        const sections = document.getElementById("depSections");
        const sectionLabel = {
          "android-gradle": "Android (Gradle)",
          "node": "Node.js",
          "python-wheel": "Python Wheels",
          "vendored-native": "Vendored Native",
        };
        try {
          const res = await fetch("licenses/dependency_inventory.json", { cache: "no-store" });
          if (!res.ok) throw new Error("inventory not found");
          const data = await res.json();
          const deps = Array.isArray(data.dependencies) ? data.dependencies : [];
          summary.textContent = "Dependencies: " + deps.length;
          if (deps.length === 0) {
            sections.innerHTML = "<div class='muted'>(empty)</div>";
            return;
          }
          const byEco = {};
          for (const d of deps) {
            const eco = String(d.ecosystem || "other").trim() || "other";
            if (!byEco[eco]) byEco[eco] = [];
            byEco[eco].push(d);
          }
          const order = ["android-gradle", "node", "python-wheel", "vendored-native"];
          const ecos = order.concat(Object.keys(byEco).filter((e) => !order.includes(e)).sort());
          sections.innerHTML = "";
          for (const eco of ecos) {
            const items = byEco[eco] || [];
            if (items.length === 0) continue;
            const box = document.createElement("div");
            box.className = "section";
            const h3 = document.createElement("h3");
            h3.textContent = sectionLabel[eco] || eco;
            box.appendChild(h3);
            items.sort((a, b) => String(a.name || "").localeCompare(String(b.name || "")));
            for (const d of items) {
              const row = document.createElement("div");
              row.className = "dep";
              const name = String(d.name || "(unknown)");
              const ver = String(d.version || "").trim();
              const lic = String(d.license || "").trim() || "unknown";
              row.textContent = (ver ? (name + "@" + ver) : name) + " - " + lic;
              box.appendChild(row);
            }
            sections.appendChild(box);
          }
        } catch (_) {
          summary.textContent = "Dependency inventory is not available in this build.";
          sections.innerHTML = "";
        }
      })();
    </script>
  </body>
  </html>
